# ナレッジチャットシステム

INBOXのアポメモを自動的にタグ付けし、業界別・能力開発テーマ別にナレッジ化するシステムです。**段階的ナレッジ提示システム**により、ユーザが早期にナレッジを確認でき、必要に応じて深掘りできる対話型検索機能を搭載しています。

## 🎯 概要

法人営業が顧客からヒアリングした情報を、研修やアセスメントに活用できるよう、ナレッジとして体系化するシステムです。LLMによる自然言語での対話を通じて、関連性の高いナレッジファイルを検索・表示できます。

### 主な機能

1. **INBOX監視**: 新規ファイルの自動検出
2. **自動タグ付け**: 業界・テーマ・課題・施策の自動抽出
3. **ナレッジ生成**: 業界別・能力開発テーマ別のナレッジファイル作成
4. **段階的ナレッジ提示システム**: 早期ナレッジ提示+継続促進による最適な情報提供
5. **LLM完全信頼型チャット**: 自然言語での対話によるナレッジ検索
6. **フォールバック機能**: LLMエラー時のキーワードベース検索

## 🚀 最新機能: 段階的ナレッジ提示システム

### ✨ 特徴

* **早期満足**: 業界やテーマが特定できればすぐにナレッジ提示
* **継続促進**: 具体的な質問例付きで自然な深掘りを促進
* **ユーザ主導**: ユーザが満足すれば終了、興味があれば継続
* **動的対話**: 固定パターンではなく、文脈に応じた質問例を動的生成
* **LLM完全信頼**: 曖昧性検出、キーワード生成、検索戦略をLLMに完全委任

### 🔄 段階的フロー

```
曖昧な質問 → 掘り下げ質問 → ナレッジ提示 + 継続促進
                ↓
具体的な質問 → 直接ナレッジ提示 + 継続促進
                ↓
継続質問 → 詳細ナレッジ提示 + 継続促進
```

### 💬 継続促進メッセージ

システムは自動的に継続促進メッセージを生成します：

**初回提示時:**
```
💬 さらに詳細にテーマを絞りたい場合は、お話しください。
例：「IT業界の具体的な事例は？」、「研修期間や方法について詳しく知りたい」
```

**継続対話時:**
```
💬 他に気になる点があれば、お話しください。
```

### セットアップ

1. **バックエンド起動**

```bash
cd backend
python3 main_simple.py
```

2. **フロントエンド起動**

```bash
open http://localhost:8000
```

3. **Ollama設定** (LLM使用時)

```bash
# Ollamaのインストールとモデルダウンロード
ollama pull qwen2.5:7b
```

## 📁 プロジェクト構造

```
Obsidian Vault/
├── INBOX/                    # アポメモの入力フォルダ
├── KNOWLEDGE/                # 生成されたナレッジファイル
│   ├── 業界別/
│   └── 能力開発テーマ/
├── FRONTEND/                 # チャットUI
│   └── index.html
├── backend/                  # FastAPIバックエンド
│   └── main_simple.py
├── PROCESSING/               # 処理中・完了ファイル
├── ナレッジ階層化_自動化スクリプト.py  # メインスクリプト
├── tag_config.json          # タグ設定ファイル
└── 要件定義書_意図特定機能.md  # システム仕様書
```

## 🚀 セットアップ

### 前提条件

* Python 3.7以上
* Obsidian Vault
* Ollama (LLM使用時)

### インストール

1. リポジトリをクローン

```bash
git clone https://github.com/SATONODOKA/shib-rain.git
cd shib-rain
```

2. ナレッジ階層化スクリプトを実行

```bash
python3 ナレッジ階層化_自動化スクリプト.py
```

3. バックエンドを起動

```bash
cd backend
python3 main_simple.py
```

4. フロントエンドを開く

```bash
open http://localhost:8000
```

## 📋 使用方法

### 1. INBOXにメモを追加

INBOXフォルダにアポメモを追加すると、自動的にタグ付けされます。

### 2. ナレッジファイルの生成

スクリプトを実行すると、以下の階層でナレッジファイルが生成されます：

* **業界別**: 業界一般、バリューチェーン別
* **能力開発テーマ別**: テーマ×業界

### 3. 段階的ナレッジ提示システムでの検索

フロントエンドで自然言語で質問を入力すると、段階的ナレッジ提示システムが以下のように動作します：

#### 🎯 使用例

**Step 1: 初回質問**
```
ユーザー: 「IT業界の人材育成について教えて」
システム: [関連ナレッジ3-4件を即座に表示]
         💬 さらに詳細にテーマを絞りたい場合は、お話しください。
         例：「IT業界の具体的な事例は？」
```

**Step 2: 継続質問（任意）**
```
ユーザー: 「新人研修の期間について知りたい」
システム: [より具体的なナレッジ2-3件を表示]
         💬 他に気になる点があれば、お話しください。
```

**Step 3: ユーザ判断**
- 満足すれば終了
- さらに興味があれば継続

#### 📝 その他の質問例

* 「中堅層の離職について知りたい」
* 「製造業の組織風土改革の事例を教えて」
* 「女性活躍の取り組みについて詳しく」
* 「建設業界の現場職人育成について」

## 🏷️ タグ体系

### 業界
* 建設業界、製造業、IT業界、金融業界、サービス業、小売業、医療業界、教育業界、運輸業界

### 能力開発テーマ
* 組織風土改革、女性活躍、働き方改革、採用戦略、人材育成、評価制度、コミュニケーション、意思決定、プロジェクト管理、リーダーシップ、コーチング、若手の自立、エンゲージメント、コンサル

### バリューチェーン
* 現場職人、現場監督、設計者、デベロッパー、コンサルタント、管理職、経営層

### 問題・課題
* 人材不足、長時間労働、離職率、コミュニケーション不足、意思決定遅延、現場と本社の乖離、世代間ギャップ、女性参入障壁

### 施策・打ち手
* フレックスタイム、リモートワーク、メンター制度、評価制度改革、研修プログラム、組織開発、ICT活用、プロセス改善、組織再編、環境整備

### 結果
* 成功事例、失敗事例、効果測定済み、継続中、中止、他社展開済み

## 🔧 カスタマイズ

### タグの追加

`tag_config.json`を編集するか、スクリプト内の`add_tag_rule()`メソッドを使用：

```python
system.add_tag_rule('業界', '新しい業界', ['キーワード1', 'キーワード2'])
```

### ナレッジテンプレートの変更

`create_knowledge_content()`メソッド内のテンプレートを編集してください。

### 段階的ナレッジ提示システムの調整

`backend/main_simple.py`の`StepwiseKnowledgeService`クラス内の以下を調整できます：

* **判断基準**: `should_show_knowledge()`メソッドのキーワードリスト
* **継続メッセージ**: `_generate_continuation_message()`メソッド
* **検索ロジック**: `_broad_search()`と`_focused_search()`メソッド

## 📊 グランドルール

1. **引用元の明示**: ナレッジファイルには必ずINBOXの元ファイルへのリンクを記載
2. **タグ体系の拡張性**: 外部ファイルで管理し、現場の変化に柔軟に対応
3. **ナレッジの厚み**: INBOXの素材が増えるほど自動的に充実・多層化
4. **参照・連絡フロー**: ナレッジページで全体像を掴み、詳細は引用元や担当者にアクセス
5. **LLM完全信頼**: 曖昧性検出とキーワード生成はLLMに完全委任
6. **ユーザ主導**: 段階的提示でユーザが情報の深さを決定

## 🧪 テスト済み機能

### ✅ 段階的ナレッジ提示システム

- **具体的質問**: 即座にナレッジ提示（例：「IT業界の人材育成について教えて」）
- **継続対話**: 絞り込んだ詳細検索（例：「研修期間について詳しく」）
- **曖昧質問**: 掘り下げ質問で具体化（例：「人材について教えて」→「どちらの業界の人材について知りたいですか？」）

### ✅ LLM完全信頼アーキテクチャ

- **自然言語理解**: 業界・テーマの自動識別
- **動的検索**: 文脈に応じたファイル選択
- **フォールバック**: エラー時の代替検索

## 🤝 貢献

1. このリポジトリをフォーク
2. 機能ブランチを作成 (`git checkout -b feature/amazing-feature`)
3. 変更をコミット (`git commit -m 'Add some amazing feature'`)
4. ブランチにプッシュ (`git push origin feature/amazing-feature`)
5. プルリクエストを作成

## 📄 ライセンス

このプロジェクトはMITライセンスの下で公開されています。

## 📞 サポート

質問や問題がある場合は、GitHubのIssuesページでお知らせください。 